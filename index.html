<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scroll</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="./asset/css/reset.css">
    <link rel="stylesheet" href="./asset/css/style.css">
</head>
<body>
    <div class="wrap">
        <section class="section-1" data-bgcolor="#000">
            <p class="intro-text">Ïö∞Î¶¨Í∞Ä Ìï®ÍªòÌïú ÏãúÍ∞Ñ</p>

            <div class="day-wrapper">
                <span id="day-counter">0</span>
                <span class="day-text">DAYS</span>
            </div>

            <div class="sub-info">
                <span id="live-time">00:00:00.00</span>
            </div>

            <div class="scroll-guide" id="scroll-guide">SCROLL</div>
        </section>

        <section class="section-2" data-bgcolor="#000">
            <div id="container">
                <!-- Edit the letter attr to: N, E, T, F, L, I or X -->
                <netflixintro letter="N">
                    <div class="helper-1">
                        <div class="effect-brush">
                            <span class="fur-31"></span>
                            <span class="fur-30"></span>
                            <span class="fur-29"></span>
                            <span class="fur-28"></span>
                            <span class="fur-27"></span>
                            <span class="fur-26"></span>
                            <span class="fur-25"></span>
                            <span class="fur-24"></span>
                            <span class="fur-23"></span>
                            <span class="fur-22"></span>
                            <span class="fur-21"></span>
                            <span class="fur-20"></span>
                            <span class="fur-19"></span>
                            <span class="fur-18"></span>
                            <span class="fur-17"></span>
                            <span class="fur-16"></span>
                            <span class="fur-15"></span>
                            <span class="fur-14"></span>
                            <span class="fur-13"></span>
                            <span class="fur-12"></span>
                            <span class="fur-11"></span>
                            <span class="fur-10"></span>
                            <span class="fur-9"></span>
                            <span class="fur-8"></span>
                            <span class="fur-7"></span>
                            <span class="fur-6"></span>
                            <span class="fur-5"></span>
                            <span class="fur-4"></span>
                            <span class="fur-3"></span>
                            <span class="fur-2"></span>
                            <span class="fur-1"></span>
                        </div>
                        <div class="effect-lumieres">
                            <span class="lamp-1"></span>
                            <span class="lamp-2"></span>
                            <span class="lamp-3"></span>
                            <span class="lamp-4"></span>
                            <span class="lamp-5"></span>
                            <span class="lamp-6"></span>
                            <span class="lamp-7"></span>
                            <span class="lamp-8"></span>
                            <span class="lamp-9"></span>
                            <span class="lamp-10"></span>
                            <span class="lamp-11"></span>
                            <span class="lamp-12"></span>
                            <span class="lamp-13"></span>
                            <span class="lamp-14"></span>
                            <span class="lamp-15"></span>
                            <span class="lamp-16"></span>
                            <span class="lamp-17"></span>
                            <span class="lamp-18"></span>
                            <span class="lamp-19"></span>
                            <span class="lamp-20"></span>
                            <span class="lamp-21"></span>
                            <span class="lamp-22"></span>
                            <span class="lamp-23"></span>
                            <span class="lamp-24"></span>
                            <span class="lamp-25"></span>
                            <span class="lamp-26"></span>
                            <span class="lamp-27"></span>
                            <span class="lamp-28"></span>
                        </div>
                    </div>
                    <div class="helper-2">
                        <div class="effect-brush">
                            <span class="fur-31"></span>
                            <span class="fur-30"></span>
                            <span class="fur-29"></span>
                            <span class="fur-28"></span>
                            <span class="fur-27"></span>
                            <span class="fur-26"></span>
                            <span class="fur-25"></span>
                            <span class="fur-24"></span>
                            <span class="fur-23"></span>
                            <span class="fur-22"></span>
                            <span class="fur-21"></span>
                            <span class="fur-20"></span>
                            <span class="fur-19"></span>
                            <span class="fur-18"></span>
                            <span class="fur-17"></span>
                            <span class="fur-16"></span>
                            <span class="fur-15"></span>
                            <span class="fur-14"></span>
                            <span class="fur-13"></span>
                            <span class="fur-12"></span>
                            <span class="fur-11"></span>
                            <span class="fur-10"></span>
                            <span class="fur-9"></span>
                            <span class="fur-8"></span>
                            <span class="fur-7"></span>
                            <span class="fur-6"></span>
                            <span class="fur-5"></span>
                            <span class="fur-4"></span>
                            <span class="fur-3"></span>
                            <span class="fur-2"></span>
                            <span class="fur-1"></span>
                        </div>
                    </div>
                    <div class="helper-3">
                        <div class="effect-brush">
                            <span class="fur-31"></span>
                            <span class="fur-30"></span>
                            <span class="fur-29"></span>
                            <span class="fur-28"></span>
                            <span class="fur-27"></span>
                            <span class="fur-26"></span>
                            <span class="fur-25"></span>
                            <span class="fur-24"></span>
                            <span class="fur-23"></span>
                            <span class="fur-22"></span>
                            <span class="fur-21"></span>
                            <span class="fur-20"></span>
                            <span class="fur-19"></span>
                            <span class="fur-18"></span>
                            <span class="fur-17"></span>
                            <span class="fur-16"></span>
                            <span class="fur-15"></span>
                            <span class="fur-14"></span>
                            <span class="fur-13"></span>
                            <span class="fur-12"></span>
                            <span class="fur-11"></span>
                            <span class="fur-10"></span>
                            <span class="fur-9"></span>
                            <span class="fur-8"></span>
                            <span class="fur-7"></span>
                            <span class="fur-6"></span>
                            <span class="fur-5"></span>
                            <span class="fur-4"></span>
                            <span class="fur-3"></span>
                            <span class="fur-2"></span>
                            <span class="fur-1"></span>
                        </div>
                    </div>
                    <div class="helper-4">
                        <div class="effect-brush">
                            <span class="fur-31"></span>
                            <span class="fur-30"></span>
                            <span class="fur-29"></span>
                            <span class="fur-28"></span>
                            <span class="fur-27"></span>
                            <span class="fur-26"></span>
                            <span class="fur-25"></span>
                            <span class="fur-24"></span>
                            <span class="fur-23"></span>
                            <span class="fur-22"></span>
                            <span class="fur-21"></span>
                            <span class="fur-20"></span>
                            <span class="fur-19"></span>
                            <span class="fur-18"></span>
                            <span class="fur-17"></span>
                            <span class="fur-16"></span>
                            <span class="fur-15"></span>
                            <span class="fur-14"></span>
                            <span class="fur-13"></span>
                            <span class="fur-12"></span>
                            <span class="fur-11"></span>
                            <span class="fur-10"></span>
                            <span class="fur-9"></span>
                            <span class="fur-8"></span>
                            <span class="fur-7"></span>
                            <span class="fur-6"></span>
                            <span class="fur-5"></span>
                            <span class="fur-4"></span>
                            <span class="fur-3"></span>
                            <span class="fur-2"></span>
                            <span class="fur-1"></span>
                        </div>
                    </div>
                </netflixintro>
            </div>
        </section>

        <section class="section-3" data-bgcolor="#000">
            <div class="inner">
                <p class="line first">ÎßéÏù¥ ÎÜÄÎûêÏßÄ?</p>
                <p class="line">Ïò§Îû´ÎèôÏïà Ïù¥ ÏàúÍ∞ÑÏùÑ Í∏∞Îã§Î†§ÏôîÏñ¥</p>
                <p class="line">Ïö∞Î¶¨Í∞Ä Ï≤òÏùå ÎßåÎÇú ÎÇ†Î∂ÄÌÑ∞</p>
                <p class="line">6ÎÖÑÏù¥ÎùºÎäî ÏãúÍ∞ÑÏù¥ ÌùêÎ•¥Îäî ÎèôÏïà</p>
                <p class="line">ÌïúÍ≤∞Í∞ôÏù¥ ÎÇ¥ ÏòÜÏùÑ ÏßÄÏºúÏ£ºÎäî ÎÑàÎ•º Î≥¥Î©∞</p>
                <p class="line">Ïù¥ ÏÇ¨ÎûåÏùÑ ÎØøÍ≥† Í≤∞ÌòºÌï† Ïàò ÏûàÍ≤†Îã§ Í≤∞Ïã¨ÌñàÏñ¥</p>
                <p class="line">Ïö∞Î¶¨Í∞Ä Ìï®Íªò ÏåìÏïÑÏò® ÎØøÏùåÏúºÎ°ú</p>
                <p class="line">Ïù¥Ï†ú ÎÑàÏôÄ ÌèâÏÉùÏùÑ Ìï®ÍªòÌïòÍ≥† Ïã∂Ïñ¥</p>
            </div>
        </section>
        <section class="section-4" data-bgcolor="#000">
                <div class="display-area">
                    <strong id="main-msg" class="main-massage">Will you marry me?</strong>
                    <div id="photo" class="image-container">
                        <img src="./asset/images/KakaoTalk_20260226_220809178.jpg" alt="Special Moment">
                    </div>
                </div>

                <div class="button-group" id="btn-wrap">
                    <button id="btn-yes" class="ready" onclick="clickYes()">
                        <div class="message submitMessage"><span>Yes</span></div>
                        <div class="message loadingMessage">
                        <svg viewbox="0 0 19 17">
                            <circle cx="2.2" cy="10" r="1.6" style="animation: loading 1s infinite"/>
                            <circle cx="9.5" cy="10" r="1.6" style="animation: loading 1s infinite; animation-delay: .1s"/>
                            <circle cx="16.8" cy="10" r="1.6" style="animation: loading 1s infinite; animation-delay: .2s"/>
                        </svg>
                        </div>
                        <div class="message successMessage"><span>üíç</span></div>
                    </button>

                    <button id="btn-no" 
                            onmouseover="dodgeNo(event)" 
                            onmousedown="dodgeNo(event)" 
                            ontouchstart="dodgeNo(event)" 
                            onclick="clickNo()">
                        <span class="no-text">No</span>
                    </button>
                </div>
                    
                <canvas id="canvas"></canvas>
        </section>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/ScrollToPlugin.min.js"></script>

    <script>
        gsap.registerPlugin(ScrollTrigger);

        /**
         * 1. Î∞∞Í≤ΩÏÉâ Ïä§ÌÅ¨Î°§ Ï†úÏñ¥
         */
        function initScrollBackground() {
            gsap.utils.toArray("section").forEach((item) => {

                // üî• section-3Îäî Ï†úÏô∏
                if(item.classList.contains("section-3")) return;

                const color = item.getAttribute("data-bgcolor");
                if (!color) return;
                

                ScrollTrigger.create({
                    trigger: item,
                    start: "top 60%",
                    end: "bottom 40%",
                    onEnter: () => gsap.to("body", { backgroundColor: color, duration: 0.8 }),
                    onEnterBack: () => gsap.to("body", { backgroundColor: color, duration: 0.8 }),
                });
            });
        }

        /**
         * 2. ÏÑπÏÖò 1 Ïπ¥Ïö¥ÌåÖ Ïï†ÎãàÎ©îÏù¥ÏÖò
         */
        function initIntroAnimation() {
            const baseDate = new Date("2019-12-22");
            const now = new Date();

            const targetDay = Math.floor(
                (new Date(now.getFullYear(), now.getMonth(), now.getDate()) -
                new Date(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate()))
                / (1000 * 60 * 60 * 24)
            ) + 1;

            const dayEl = document.querySelector("#day-counter");
            const scrollGuide = document.querySelector("#scroll-guide");
            if (!dayEl) return;

            const dayCounter = { value: 0 };
            const splitPoint = Math.min(2000, targetDay);

            const tl = gsap.timeline();

            tl.to(dayCounter, {
                value: splitPoint,
                duration: 1.2,
                ease: "power2.out",
                onUpdate: () => { dayEl.textContent = Math.floor(dayCounter.value); }
            })
            .to(dayCounter, {
                value: targetDay,
                duration: 1.6,
                ease: "power4.out",
                onUpdate: () => { dayEl.textContent = Math.floor(dayCounter.value); }
            })
            .to(dayEl, { scale: 1.08, duration: 0.2, yoyo: true, repeat: 1 })
            .call(() => {
                if(scrollGuide){
                    gsap.to(scrollGuide, { opacity: 9, duration: 1 });
                }
            });
        }

        /**
         * 3. Ïã§ÏãúÍ∞Ñ ÏãúÍ≥Ñ
         */
        function initClock() {
            const timeEl = document.querySelector("#live-time");
            if (!timeEl) return;

            function update() {
                const now = new Date();
                const h = String(now.getHours()).padStart(2, "0");
                const m = String(now.getMinutes()).padStart(2, "0");
                const s = String(now.getSeconds()).padStart(2, "0");
                const ms = String(Math.floor(now.getMilliseconds()/10)).padStart(2, "0");

                timeEl.textContent = `${h}:${m}:${s}.${ms}`;
                requestAnimationFrame(update);
            }
            update();
        }

        /* secion 2 */
        function initSection2Animation(){

            const section2 = document.querySelector(".section-2");
            const netflixIntro = document.querySelector("netflixintro");

            if(!section2 || !netflixIntro) return;

            const tl = gsap.timeline({
                scrollTrigger:{
                    trigger: section2,
                    start: "top top",
                    end: "+=2000",
                    pin: true,
                    scrub: false,
                    once: true,
                    onEnter: () => {
                        netflixIntro.classList.add("play");
                    },
                    onLeave: () => {
                        gsap.to(window, {
                            duration: 1.2,
                            scrollTo: ".section-3",
                            ease: "power2.inOut"
                        });
                    }
                }
            });

        }
        /**
         * 4. Section 3 Ïï†ÎãàÎ©îÏù¥ÏÖò
         */

        function initLetter(){

            gsap.set(".section-3 .line:not(.first)", { y:60 });

            const lines = gsap.utils.toArray(".section-3 .line");

            const tl = gsap.timeline({
                scrollTrigger:{
                    trigger: ".section-3",
                    start: "top top",
                    end: "+=2800",
                    scrub: 1,
                    pin: true,
                    anticipatePin:1
                }
            });

            // Ï≤´ Ï§Ñ
            tl.to(lines[0], {
                filter:"blur(0px)",
                duration:1.5,
                ease:"power2.out"
            });

            tl.to(lines[0], {
                opacity:0,
                duration:1
            });

            // ÎÇòÎ®∏ÏßÄ Ï§ÑÎì§
            lines.slice(1).forEach(line => {

                tl.to(line,{
                    opacity:1,
                    y:0,
                    duration:1.2,
                    ease:"power3.out"
                });

                tl.to(line,{
                    opacity:0,
                    y:-60,
                    duration:1
                });

            });

        }
   
        window.onload = () => {
            initScrollBackground();
            initIntroAnimation();
            initClock();
            initLetter();
            initSection2Animation(); 
            ScrollTrigger.refresh();
        };

        /* secion 4 */
          const btnYes = document.getElementById('btn-yes');
            const btnNo = document.getElementById('btn-no');
            const mainMsg = document.getElementById('main-msg');
            const photo = document.getElementById('photo');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            let noClickCount = 0;
            let disabled = false;

            function dodgeNo(e) {
                if (noClickCount < 2) {
                // Î™®Î∞îÏùºÏóêÏÑú ÌÑ∞Ïπò Ïãú Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Î∞©ÏßÄ (ÌÅ¥Î¶≠ Î∞úÏÉù ÏñµÏ†ú)
                if (e.type === 'touchstart') {
                    // e.preventDefault(); // ÌïÑÏöî Ïãú ÌôúÏÑ±Ìôî
                }

                const padding = 50; // ÌôîÎ©¥ Í∞ÄÏû•ÏûêÎ¶¨ Ïó¨Ïú† Í≥µÍ∞Ñ
                // Ïù¥Îèô Í∞ÄÎä•Ìïú ÏµúÎåÄ Î≤îÏúÑ Í≥ÑÏÇ∞
                const maxX = (window.innerWidth / 2) - padding;
                const maxY = (window.innerHeight / 2) - padding;
                
                const randomX = (Math.random() - 0.5) * window.innerWidth * 0.8;
                const randomY = (Math.random() - 0.5) * window.innerHeight * 0.6;
                
                btnNo.style.transform = `translate(${randomX}px, ${randomY}px)`;
                }
            }

            function clickNo() {
                noClickCount++;
                if (noClickCount >= 2) {
                btnNo.classList.add('vanish');
                btnYes.classList.add('full-width');
                setTimeout(() => {
                    btnNo.style.display = 'none';
                }, 500);
                } else {
                dodgeNo();
                }
            }

            function clickYes() {
                if (disabled) return;
                disabled = true;
                
                btnNo.classList.add('vanish');
                btnYes.classList.add('full-width');
                btnYes.className = 'loading full-width';

                setTimeout(() => {
                btnYes.className = 'complete full-width';
                mainMsg.classList.add('hide');
                setTimeout(() => {
                    burst();
                    photo.classList.add('show');
                }, 320);
                }, 1500);
            }

            // --- Ïª®ÌéòÌã∞ Î°úÏßÅ ---
            const COLORS = [{ front:'#ff5c8a', back:'#e04572' }, { front:'#b3c7ff', back:'#8fa5e5' }, { front:'#ffcc00', back:'#d1a700' }];
            const rand = (a, b) => Math.random() * (b - a) + a;
            let confetti = [];

            function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
            window.addEventListener('resize', resize);
            resize();

            class Confetto {
                constructor() {
                this.mod = rand(0, 99);
                this.color = COLORS[Math.floor(rand(0, 3))];
                this.dim = { x: rand(5,9), y: rand(8,15) };
                this.pos = { x: rand(innerWidth/2 - 100, innerWidth/2 + 100), y: rand(innerHeight/2, innerHeight/2 + 100) };
                this.rot = rand(0, 2*Math.PI);
                this.scale = { x:1, y:1 };
                this.vel = { x: rand(-10, 10), y: -rand(7, 12) };
                }
                update() {
                this.vel.x -= this.vel.x * 0.075; this.vel.y = Math.min(this.vel.y + 0.3, 3);
                this.pos.x += this.vel.x; this.pos.y += this.vel.y;
                this.scale.y = Math.cos((this.pos.y + this.mod) * 0.09);
                }
            }

            function burst() { for (let i=0; i<50; i++) confetti.push(new Confetto()); }

            function render() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                confetti.forEach(c => {
                const w = c.dim.x * c.scale.x, h = c.dim.y * c.scale.y;
                ctx.translate(c.pos.x, c.pos.y); ctx.rotate(c.rot); c.update();
                ctx.fillStyle = c.scale.y > 0 ? c.color.front : c.color.back;
                ctx.fillRect(-w/2, -h/2, w, h); ctx.setTransform(1,0,0,1,0,0);
                });
                requestAnimationFrame(render);
            }
            render();
    </script>
</body>
</html>