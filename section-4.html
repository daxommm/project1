<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Confetti Proposal Button</title>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Sans+KR:wght@300;500&display=swap" rel="stylesheet">
<style>
  @keyframes loading {
    0%, 50% { cy: 10; }
    25% { cy: 3; }
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body { 
    background: #000; 
    -webkit-font-smoothing: antialiased;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Noto Sans KR', sans-serif;
    overflow: hidden;
    touch-action: manipulation; /* Í∏∞Î≥∏ ÌÑ∞Ïπò ÎèôÏûë ÏµúÏ†ÅÌôî */
  }

  section {
    position: relative;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 500px;
    width: 100%;
  }

  .display-area {
    position: relative;
    width: 85%;
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 40px;
  }

  .main-massage {
    position: absolute;
    font-size: 2.5rem;
    color: #fff;
    transition: all 0.8s ease;
    width: 100%;
    z-index: 5;
  }

  .main-massage.hide { opacity: 0; transform: translateY(-30px); pointer-events: none; }

  .image-container {
    position: absolute;
    width: 100%;
    height: 210px;
    opacity: 0;
    transform: translateY(30px);
    transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    overflow: hidden;
  }

  .image-container.show { opacity: 1; transform: translateY(0); }
  .image-container img { width: 100%; height: 100%; object-fit: cover; }

  .button-group {
    display: flex;
    gap: 15px;
    width: 100%;
    max-width: 400px;
    justify-content: center;
    position: relative;
  }

  button {
    position: relative;
    height: 50px;
    border: none; outline: none;
    color: #f4f7ff;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s, width 0.5s;
    border-radius: 50px;
    -webkit-tap-highlight-color: transparent; /* Î™®Î∞îÏùº ÌÑ∞Ïπò ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞ */
  }

  #btn-yes { width: 140px; background: #fff; box-shadow: 0 0 8px #eae0ab, 0 0 12px #FFC0CB, 0 0 16px #FFFAF0; color: #000; flex-shrink: 0; }
  #btn-yes.full-width { width: 90% !important; font-size: 20px; } 

  #btn-no {
    width: 140px;
    background: #000;
    border: 1px solid #fff;
    color: #fff;
    flex-shrink: 0;
  }
  
  #btn-no.vanish { opacity: 0; transform: scale(0) !important; pointer-events: none; width: 0 !important; margin: 0; padding: 0; }

  .message {
    position: absolute; left: 50%; top: 50%;
    transform: translate(-50%,-50%);
    width: 100%;
    display: flex; align-items: center; justify-content: center;
    pointer-events: none;
  }

  .submitMessage { opacity: 0; transition: opacity 0.3s; }
  .loadingMessage { opacity: 0; transition: opacity 0.3s; }
  .loadingMessage svg { fill: gray; width: 22px; height: 17px; }
  .successMessage { opacity: 0; transition: opacity 0.3s; font-size: 18px; white-space: nowrap; }

  button.ready .submitMessage { opacity: 1; }
  button.loading .submitMessage { opacity: 0; }
  button.loading .loadingMessage { opacity: 1; }
  button.complete .loadingMessage { opacity: 0; }
  button.complete .successMessage { opacity: 1; transition: opacity 0.3s ease 0.5s; }

  canvas { position: fixed; inset: 0; pointer-events: none; z-index: 2; }
</style>
</head>
<body>

<section>
    <div class="display-area">
      <strong id="main-msg" class="main-massage">Will you marry me?</strong>
      <div id="photo" class="image-container">
        <img src="./asset/images/KakaoTalk_20260226_220809178.jpg" alt="Special Moment">
      </div>
    </div>

    <div class="button-group" id="btn-wrap">
      <button id="btn-yes" class="ready" onclick="clickYes()">
        <div class="message submitMessage"><span>Yes</span></div>
        <div class="message loadingMessage">
          <svg viewbox="0 0 19 17">
            <circle cx="2.2" cy="10" r="1.6" style="animation: loading 1s infinite"/>
            <circle cx="9.5" cy="10" r="1.6" style="animation: loading 1s infinite; animation-delay: .1s"/>
            <circle cx="16.8" cy="10" r="1.6" style="animation: loading 1s infinite; animation-delay: .2s"/>
          </svg>
        </div>
        <div class="message successMessage"><span>üíç</span></div>
      </button>

      <button id="btn-no" 
              onmouseover="dodgeNo(event)" 
              onmousedown="dodgeNo(event)" 
              ontouchstart="dodgeNo(event)" 
              onclick="clickNo()">
        <span class="no-text">No</span>
      </button>
    </div>
    
    <canvas id="canvas"></canvas>
</section>

<script>
  const btnYes = document.getElementById('btn-yes');
  const btnNo = document.getElementById('btn-no');
  const mainMsg = document.getElementById('main-msg');
  const photo = document.getElementById('photo');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  
  let noClickCount = 0;
  let disabled = false;

  function dodgeNo(e) {
    if (noClickCount < 2) {
      // Î™®Î∞îÏùºÏóêÏÑú ÌÑ∞Ïπò Ïãú Ïù¥Î≤§Ìä∏ Ï†ÑÌåå Î∞©ÏßÄ (ÌÅ¥Î¶≠ Î∞úÏÉù ÏñµÏ†ú)
      if (e.type === 'touchstart') {
        // e.preventDefault(); // ÌïÑÏöî Ïãú ÌôúÏÑ±Ìôî
      }

      const padding = 50; // ÌôîÎ©¥ Í∞ÄÏû•ÏûêÎ¶¨ Ïó¨Ïú† Í≥µÍ∞Ñ
      // Ïù¥Îèô Í∞ÄÎä•Ìïú ÏµúÎåÄ Î≤îÏúÑ Í≥ÑÏÇ∞
      const maxX = (window.innerWidth / 2) - padding;
      const maxY = (window.innerHeight / 2) - padding;
      
      const randomX = (Math.random() - 0.5) * window.innerWidth * 0.8;
      const randomY = (Math.random() - 0.5) * window.innerHeight * 0.6;
      
      btnNo.style.transform = `translate(${randomX}px, ${randomY}px)`;
    }
  }

  function clickNo() {
    noClickCount++;
    if (noClickCount >= 2) {
      btnNo.classList.add('vanish');
      btnYes.classList.add('full-width');
      setTimeout(() => {
        btnNo.style.display = 'none';
      }, 500);
    } else {
      dodgeNo();
    }
  }

  function clickYes() {
    if (disabled) return;
    disabled = true;
    
    btnNo.classList.add('vanish');
    btnYes.classList.add('full-width');
    btnYes.className = 'loading full-width';

    setTimeout(() => {
      btnYes.className = 'complete full-width';
      mainMsg.classList.add('hide');
      setTimeout(() => {
        burst();
        photo.classList.add('show');
      }, 320);
    }, 1500);
  }

  // --- Ïª®ÌéòÌã∞ Î°úÏßÅ ---
  const COLORS = [{ front:'#ff5c8a', back:'#e04572' }, { front:'#b3c7ff', back:'#8fa5e5' }, { front:'#ffcc00', back:'#d1a700' }];
  const rand = (a, b) => Math.random() * (b - a) + a;
  let confetti = [];

  function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
  window.addEventListener('resize', resize);
  resize();

  class Confetto {
    constructor() {
      this.mod = rand(0, 99);
      this.color = COLORS[Math.floor(rand(0, 3))];
      this.dim = { x: rand(5,9), y: rand(8,15) };
      this.pos = { x: rand(innerWidth/2 - 100, innerWidth/2 + 100), y: rand(innerHeight/2, innerHeight/2 + 100) };
      this.rot = rand(0, 2*Math.PI);
      this.scale = { x:1, y:1 };
      this.vel = { x: rand(-10, 10), y: -rand(7, 12) };
    }
    update() {
      this.vel.x -= this.vel.x * 0.075; this.vel.y = Math.min(this.vel.y + 0.3, 3);
      this.pos.x += this.vel.x; this.pos.y += this.vel.y;
      this.scale.y = Math.cos((this.pos.y + this.mod) * 0.09);
    }
  }

  function burst() { for (let i=0; i<50; i++) confetti.push(new Confetto()); }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    confetti.forEach(c => {
      const w = c.dim.x * c.scale.x, h = c.dim.y * c.scale.y;
      ctx.translate(c.pos.x, c.pos.y); ctx.rotate(c.rot); c.update();
      ctx.fillStyle = c.scale.y > 0 ? c.color.front : c.color.back;
      ctx.fillRect(-w/2, -h/2, w, h); ctx.setTransform(1,0,0,1,0,0);
    });
    requestAnimationFrame(render);
  }
  render();
</script>
</body>
</html>